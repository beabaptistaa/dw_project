{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar _slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n    return _arr;\n  }\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n  return target;\n};\nvar _helpers = require('../helpers');\nvar loadPage = function loadPage(data, popstate) {\n  var _this = this;\n\n  // create array for storing animation promises\n  var animationPromises = [],\n    xhrPromise = void 0;\n  var animateOut = function animateOut() {\n    _this.triggerEvent('animationOutStart');\n\n    // handle classes\n    document.documentElement.classList.add('is-changing');\n    document.documentElement.classList.add('is-leaving');\n    document.documentElement.classList.add('is-animating');\n    if (popstate) {\n      document.documentElement.classList.add('is-popstate');\n    }\n    document.documentElement.classList.add('to-' + (0, _helpers.classify)(data.url));\n\n    // animation promise stuff\n    animationPromises = _this.getAnimationPromises('out');\n    Promise.all(animationPromises).then(function () {\n      _this.triggerEvent('animationOutDone');\n    });\n\n    // create history record if this is not a popstate call\n    if (!popstate) {\n      // create pop element with or without anchor\n      var state = void 0;\n      if (_this.scrollToElement != null) {\n        state = data.url + _this.scrollToElement;\n      } else {\n        state = data.url;\n      }\n      (0, _helpers.createHistoryRecord)(state);\n    }\n  };\n  this.triggerEvent('transitionStart', popstate);\n\n  // set transition object\n  if (data.customTransition != null) {\n    this.updateTransition(window.location.pathname, data.url, data.customTransition);\n    document.documentElement.classList.add('to-' + (0, _helpers.classify)(data.customTransition));\n  } else {\n    this.updateTransition(window.location.pathname, data.url);\n  }\n\n  // start/skip animation\n  if (!popstate || this.options.animateHistoryBrowsing) {\n    animateOut();\n  } else {\n    this.triggerEvent('animationSkipped');\n  }\n\n  // start/skip loading of page\n  if (this.cache.exists(data.url)) {\n    xhrPromise = new Promise(function (resolve) {\n      resolve(_this.cache.getPage(data.url));\n    });\n    this.triggerEvent('pageRetrievedFromCache');\n  } else {\n    if (!this.preloadPromise || this.preloadPromise.route != data.url) {\n      xhrPromise = new Promise(function (resolve, reject) {\n        (0, _helpers.fetch)(_extends({}, data, {\n          headers: _this.options.requestHeaders\n        }), function (response) {\n          if (response.status === 500) {\n            _this.triggerEvent('serverError');\n            reject(data.url);\n            return;\n          } else {\n            // get json data\n            var page = _this.getPageData(response);\n            if (page != null && page.blocks.length > 0) {\n              page.url = data.url;\n            } else {\n              reject(data.url);\n              return;\n            }\n            // render page\n            _this.cache.cacheUrl(page);\n            _this.triggerEvent('pageLoaded');\n            resolve(page);\n          }\n        });\n      });\n    } else {\n      xhrPromise = this.preloadPromise;\n    }\n  }\n\n  // when everything is ready, handle the outcome\n  Promise.all([xhrPromise].concat(animationPromises)).then(function (_ref) {\n    var _ref2 = _slicedToArray(_ref, 1),\n      pageData = _ref2[0];\n\n    // render page\n    _this.renderPage(pageData, popstate);\n    _this.preloadPromise = null;\n  }).catch(function (errorUrl) {\n    // rewrite the skipPopStateHandling function to redirect manually when the history.go is processed\n    _this.options.skipPopStateHandling = function () {\n      window.location = errorUrl;\n      return true;\n    };\n\n    // go back to the actual page were still at\n    window.history.go(-1);\n  });\n};\nexports.default = loadPage;","map":{"version":3,"names":["Object","defineProperty","exports","value","_slicedToArray","sliceIterator","arr","i","_arr","_n","_d","_e","undefined","_i","Symbol","iterator","_s","next","done","push","length","err","Array","isArray","TypeError","_extends","assign","target","arguments","source","key","prototype","hasOwnProperty","call","_helpers","require","loadPage","data","popstate","_this","animationPromises","xhrPromise","animateOut","triggerEvent","document","documentElement","classList","add","classify","url","getAnimationPromises","Promise","all","then","state","scrollToElement","createHistoryRecord","customTransition","updateTransition","window","location","pathname","options","animateHistoryBrowsing","cache","exists","resolve","getPage","preloadPromise","route","reject","fetch","headers","requestHeaders","response","status","page","getPageData","blocks","cacheUrl","concat","_ref","_ref2","pageData","renderPage","catch","errorUrl","skipPopStateHandling","history","go","default"],"sources":["/Users/beatrizbaptista/Desktop/mestrado/DW/projeto/code/node_modules/swup/lib/modules/loadPage.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _helpers = require('../helpers');\n\nvar loadPage = function loadPage(data, popstate) {\n\tvar _this = this;\n\n\t// create array for storing animation promises\n\tvar animationPromises = [],\n\t    xhrPromise = void 0;\n\tvar animateOut = function animateOut() {\n\t\t_this.triggerEvent('animationOutStart');\n\n\t\t// handle classes\n\t\tdocument.documentElement.classList.add('is-changing');\n\t\tdocument.documentElement.classList.add('is-leaving');\n\t\tdocument.documentElement.classList.add('is-animating');\n\t\tif (popstate) {\n\t\t\tdocument.documentElement.classList.add('is-popstate');\n\t\t}\n\t\tdocument.documentElement.classList.add('to-' + (0, _helpers.classify)(data.url));\n\n\t\t// animation promise stuff\n\t\tanimationPromises = _this.getAnimationPromises('out');\n\t\tPromise.all(animationPromises).then(function () {\n\t\t\t_this.triggerEvent('animationOutDone');\n\t\t});\n\n\t\t// create history record if this is not a popstate call\n\t\tif (!popstate) {\n\t\t\t// create pop element with or without anchor\n\t\t\tvar state = void 0;\n\t\t\tif (_this.scrollToElement != null) {\n\t\t\t\tstate = data.url + _this.scrollToElement;\n\t\t\t} else {\n\t\t\t\tstate = data.url;\n\t\t\t}\n\n\t\t\t(0, _helpers.createHistoryRecord)(state);\n\t\t}\n\t};\n\n\tthis.triggerEvent('transitionStart', popstate);\n\n\t// set transition object\n\tif (data.customTransition != null) {\n\t\tthis.updateTransition(window.location.pathname, data.url, data.customTransition);\n\t\tdocument.documentElement.classList.add('to-' + (0, _helpers.classify)(data.customTransition));\n\t} else {\n\t\tthis.updateTransition(window.location.pathname, data.url);\n\t}\n\n\t// start/skip animation\n\tif (!popstate || this.options.animateHistoryBrowsing) {\n\t\tanimateOut();\n\t} else {\n\t\tthis.triggerEvent('animationSkipped');\n\t}\n\n\t// start/skip loading of page\n\tif (this.cache.exists(data.url)) {\n\t\txhrPromise = new Promise(function (resolve) {\n\t\t\tresolve(_this.cache.getPage(data.url));\n\t\t});\n\t\tthis.triggerEvent('pageRetrievedFromCache');\n\t} else {\n\t\tif (!this.preloadPromise || this.preloadPromise.route != data.url) {\n\t\t\txhrPromise = new Promise(function (resolve, reject) {\n\t\t\t\t(0, _helpers.fetch)(_extends({}, data, { headers: _this.options.requestHeaders }), function (response) {\n\t\t\t\t\tif (response.status === 500) {\n\t\t\t\t\t\t_this.triggerEvent('serverError');\n\t\t\t\t\t\treject(data.url);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// get json data\n\t\t\t\t\t\tvar page = _this.getPageData(response);\n\t\t\t\t\t\tif (page != null && page.blocks.length > 0) {\n\t\t\t\t\t\t\tpage.url = data.url;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treject(data.url);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// render page\n\t\t\t\t\t\t_this.cache.cacheUrl(page);\n\t\t\t\t\t\t_this.triggerEvent('pageLoaded');\n\t\t\t\t\t\tresolve(page);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\txhrPromise = this.preloadPromise;\n\t\t}\n\t}\n\n\t// when everything is ready, handle the outcome\n\tPromise.all([xhrPromise].concat(animationPromises)).then(function (_ref) {\n\t\tvar _ref2 = _slicedToArray(_ref, 1),\n\t\t    pageData = _ref2[0];\n\n\t\t// render page\n\t\t_this.renderPage(pageData, popstate);\n\t\t_this.preloadPromise = null;\n\t}).catch(function (errorUrl) {\n\t\t// rewrite the skipPopStateHandling function to redirect manually when the history.go is processed\n\t\t_this.options.skipPopStateHandling = function () {\n\t\t\twindow.location = errorUrl;\n\t\t\treturn true;\n\t\t};\n\n\t\t// go back to the actual page were still at\n\t\twindow.history.go(-1);\n\t});\n};\n\nexports.default = loadPage;"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}